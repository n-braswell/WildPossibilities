---
title: "Wild Possibilities"
author: "Nathaniel Braswell*, Madeline Meade*, Nicol√≤ Cesana-Arlotti, Laurie Santos"
date: "2/11/2025"
output: html_document
editor_options: 
  chunk_output_type: console
repository: "https://github.com/n-braswell/WildPossibilities"
description: |
  Analysis script for all four experiments. *Denotes equal contribution. Direct questions to            nathaniel.braswell@yale.edu
---

# packages
```{r}
library(dplyr)
library(ggplot2)
library(BayesFactor)
library(lmerTest)
library(lme4)
library(vangogh)
```

# directory
```{r}
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
```

# experiment 1
```{r}
exp1 <- read.csv("E1.data.csv")

# main effect
binom.test(sum(exp1$choice.bin == 1), nrow(exp1), p = 0.5, alternative="greater")
binom.test(sum(exp1$choice.bin == 1), nrow(exp1), p = 1, alternative="less")
binom.test(sum(exp1$choice.bin == 1), nrow(exp1), p = 0.75, alternative="greater")

# age/sex effects
exp1$sex <- as.factor(exp1$sex)
glm.exp1 <- glm(choice.bin ~ age + sex, data = exp1, family = binomial)
summary(glm.exp1)

# condition effects
chisq.test(table(exp1$single.side, exp1$choice.bin))
chisq.test(table(exp1$hidden.first, exp1$choice.bin))
chisq.test(table(exp1$box.removed, exp1$choice.bin))
```


# experiment 2
```{r}
exp2 <- read.csv("E2.data.csv")

# main effect
binom.test(sum(exp2$choice.bin == 1), nrow(exp2), p = 0.5, alternative = "greater")
binom.test(sum(exp2$choice.bin == 1), nrow(exp2), p = 1, alternative = "less")
binom.test(sum(exp2$choice.bin == 1), nrow(exp2), p = 0.75, alternative = "greater")

# age/sex effects
exp2$sex <- as.factor(exp2$sex)
glm.exp2 <- glm(choice.bin ~ age + sex, data = exp2, family = binomial)
summary(glm.exp2)

# condition effects
chisq.test(table(exp2$apple.side, exp2$choice.bin))

# bayesian contingency - e1 vs e2
exp1.table <- table(exp1$choice.bin)
exp2.table <- table(exp2$choice.bin)
exp12.table <- cbind(exp1.table, exp2.table)
contingencyTableBF(exp12.table, sampleType = "indepMulti", fixedMargin = "rows")
```


# experiment 3
```{r}
exp3 <- read.csv("E3.data.csv")

# main effect
binom.test(sum(exp3$choice.bin == 1), nrow(exp3), p = 0.5, alternative = "greater")
binom.test(sum(exp3$choice.bin == 1), nrow(exp3), p = 1, alternative = "less")
binom.test(sum(exp3$choice.bin == 1), nrow(exp3), p = 0.75, alternative = "greater")

# age/sex effects
glm.exp3 <- glm(choice.bin ~ age + sex, data = exp3, family = binomial)
summary(glm.exp3)

# condition effects
chisq.test(table(exp3$single.side, exp3$choice.bin))
chisq.test(table(exp3$hidden.first, exp3$choice.bin))
chisq.test(table(exp3$box.removed, exp3$choice.bin))

# bayesian contigency - e1 vs e3
exp13.table <- cbind(table(exp1$choice.bin), table(exp3$choice.bin))
contingencyTableBF(exp13.table, sampleType = "indepMulti", fixedMargin = "rows")
```

# experiment 4
```{r}
exp4 <- read.csv("E4.data.csv")

# main effect
binom.test(sum(exp4$choice.bin == 1), nrow(exp4), p = 0.5, alternative = "greater")
binom.test(sum(exp4$choice.bin == 1), nrow(exp4), p = 1, alternative = "less")
binom.test(sum(exp4$choice.bin == 1), nrow(exp4), p = 0.75, alternative = "greater")

# age/sex effects
glm.exp4 <- glm(choice.bin ~ age + sex, data = exp4, family = binomial)
summary(glm.exp4)

# condition effects
chisq.test(table(exp4$single.side, exp4$choice.bin))
chisq.test(table(exp4$hidden.first, exp4$choice.bin))

# bayesian contigency - e1 vs e4
exp14.table <- cbind(table(exp1$choice.bin), table(exp4$choice.bin))
contingencyTableBF(exp14.table, sampleType = "indepMulti", fixedMargin = "rows")

# bayesian sequential BF test (E4)
library(BayesFactor)

successes <- sum(exp4$choice.bin == 1)  # Assuming 1 = single-cup choice
trials <- nrow(exp4)

# main test
cat("Binomial test results:\n")
print(binom.test(successes, trials, p = 0.5, alternative = "greater"))
print(binom.test(successes, trials, p = 1, alternative = "less"))

# bayesian test for null
bf_result <- proportionBF(
  y = successes,
  N = trials,
  p = 0.5,
  nullInterval = c(0.5, 1),  
  rscale = "ultrawide"
)

bf_numeric <- extractBF(bf_result)$bf[1]
cat("Bayes Factor (BF10, greater than 50%):", bf_numeric, "\n")
```

# results figures
```{r}
library(vangogh)
library(ggplot2)
library(dplyr)

palette <- vangogh::vangogh_palettes$Chaise
exp1_filtered <- exp1 %>% filter(choice.bin %in% c(0, 1)) %>% rename(correct. = choice.bin)
exp2_filtered <- exp2 %>% filter(choice.bin %in% c(0, 1)) %>% rename(correct. = choice.bin)
exp3_filtered <- exp3 %>% filter(choice.bin %in% c(0, 1)) %>% rename(correct. = choice.bin)
exp4_filtered <- exp4 %>% filter(choice.bin %in% c(0, 1)) %>% rename(correct. = choice.bin)

create_plot <- function(data, file_name, x_labels, fill_colors) {
  summary_data <- data %>%
    count(correct.) %>%
    mutate(
      Proportion = n / sum(n) * 100,
      SE = sqrt((Proportion / 100) * (1 - (Proportion / 100)) / sum(n)) * 100,
      Label = factor(correct., levels = c(0, 1), labels = x_labels)
    )

  plot <- ggplot(summary_data, aes(
    x = Label,
    y = Proportion,
    fill = factor(correct., levels = c(0, 1))
  )) +
    geom_bar(stat = "identity", width = 0.7) +
    geom_errorbar(aes(ymin = Proportion - SE, ymax = Proportion + SE), width = 0.15, size = 1) +
    scale_fill_manual(values = fill_colors) +
    geom_hline(yintercept = 50, linetype = "dashed", color = "black", size = 1) +
    theme_minimal(base_size = 18) +
    theme(
      axis.text.x = element_blank(),
      axis.ticks.x = element_blank(),
      axis.title = element_blank(),
      axis.text.y = element_text(size = 18, face = "bold", color = "black"),
      panel.grid.major.x = element_blank(),
      panel.grid.major.y = element_line(color = "grey85", size = 0.5),
      panel.grid.minor = element_blank(),
      legend.position = "none",
      plot.background = element_rect(fill = "white", color = NA),
      panel.background = element_rect(fill = "white", color = NA)
    ) +
    scale_y_continuous(
      limits = c(0, 100),
      breaks = seq(0, 100, by = 20),
      labels = function(x) paste0(x, "%")
    )

  ggsave(file_name, plot, width = 6, height = 5)
}

create_plot(exp1_filtered, "E1_plot.png", c("Impossible", "Certain"), palette[c(4, 2)])
create_plot(exp2_filtered, "E2_plot.png", c("Possible", "Certain"), palette[c(5, 2)])
create_plot(exp3_filtered, "E3_plot.png", c("Possible", "Impossible"), palette[c(5, 4)])
create_plot(exp4_filtered, "E4_plot.png", c("Certain", "Possible"), palette[c(4, 2)])
```

